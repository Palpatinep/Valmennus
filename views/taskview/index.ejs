<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.4.1.min.js"" ></script>
    <script src="http://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <title>Document</title>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@600&display=swap" rel="stylesheet">
</head>
<body>
    

    <br>
    <div class="taskwrapper">
        <% if (Task != undefined) { %>
            <form action="/tehtavat/kaikki" method="POST">
                <input style="visibility: hidden" id="questionidlabel" value="<%= Task.id %>" type="text" name="questionidlabel"></input>
                <br>
                <p style="font-size: 20px;" > Kategoria: <%= Task.category %>  </p>
                <br>
                <p><%= Task.question %> </p>
                <br>
                <br>
                <br>
                <div class="choicebuttonwrapper" id="shuffle">
                    <button type="submit" class="answerbutton" id="correctanswer" name="questionchoice" value="<%=Task.correctAnswer%>"><%=Task.correctAnswer%></button>
                    <button type="submit" class="answerbutton" id="wronganswer1" name="questionchoice" value="<%=Task.wrongAnswer1%>"><%=Task.wrongAnswer1%></button>
                    <button type="submit" class="answerbutton" id="wronganswer2" name="questionchoice" value="<%=Task.wrongAnswer2%>"><%=Task.wrongAnswer2%></button>
                    <button type="submit" class="answerbutton" id="wronganswer3" name="questionchoice" value="<%=Task.wrongAnswer3%>"><%=Task.wrongAnswer3%></button>
                </div>
            </form>
            
            <br>
            <h2 id="answerresult"></h2>
            <br>
            <div class="taskdescription" id="descriptiondiv" style="visibility: hidden"><%=Task.description%></div>
            <br>
        
            <% } else { %>
                <div>TEHTÄVÄT LOPPU</div>
               <% } %>

        <button class="taskoptionbutton" onclick="window.location.reload();">Seuraava tehtävä</button>
        <button class="taskoptionbutton" style="float: right;" onclick="window.location='/tehtavat'" >Takaisin tehtävävalikkoon</button>
    </div>
    
    
    <br>
    <br>
    <br>
    <br>
    <a href="/tehtavat/luo">Luo tehtävä</a>


    <script>

        $(document).ready()
        {
            //
            // Use res.render() variables in client script: 
            // var test = '<%- JSON.stringify(Task) %>'
            // var obj = JSON.parse(test)
            //

            var parent = $("#shuffle");
            var divs = parent.children();

            while (divs.length) 
            {
                parent.append(divs.splice(Math.floor(Math.random() * divs.length), 1)[0]);
            }
        }

        $(function(){

            $("*.answerbutton").on("click", function()
            {
                event.preventDefault();

                var test = '<%- JSON.stringify(Task) %>'
                var obj = JSON.parse(test)

                console.log(this.innerHTML)
                console.log(obj.correctAnswer)

                if (this.innerHTML == obj.correctAnswer)
                {
                    document.getElementById("answerresult").innerHTML = "Oikea vastaus"
                    document.getElementById("answerresult").style.color = "#03BD00";
                    document.getElementById("correctanswer").disabled = true;
                    document.getElementById("wronganswer1").disabled = true;
                    document.getElementById("wronganswer2").disabled = true;
                    document.getElementById("wronganswer3").disabled = true;
                }
                else
                {
                    document.getElementById("answerresult").innerHTML = "Väärä vastaus"
                    document.getElementById("answerresult").style.color = "#FFA07A";
                    document.getElementById("correctanswer").disabled = true;
                    document.getElementById("wronganswer1").disabled = true;
                    document.getElementById("wronganswer2").disabled = true;
                    document.getElementById("wronganswer3").disabled = true;
                }

                document.getElementById("descriptiondiv").style.visibility = "visible";
                document.getElementById("correctanswer").style.backgroundColor = "#98FB98";
                document.getElementById("wronganswer1").style.backgroundColor = "#FFA07A";
                document.getElementById("wronganswer2").style.backgroundColor = "#FFA07A";
                document.getElementById("wronganswer3").style.backgroundColor = "#FFA07A";

                $.post("/tehtavat/answers",
                {
                    answer: this.innerHTML,
                    questionid: document.getElementById("questionidlabel").value
                },
                function(data, status){
                    alert("Data: " + data + "\nStatus: " + status);
                });

            })
        })
    </script>

</body>
</html>

